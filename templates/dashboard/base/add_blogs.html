{% load static %}

<div class="col-md-9">
    <div class="card shadow">
        <div class="card-header bg-dark text-light">
            <h4 class="mb-0">Add New Blog</h4>
        </div>
        <div class="card-body">
            <form method="POST" enctype="multipart/form-data">
                {% csrf_token %}

                <!-- Hidden input nhận detail_country từ GET -->
                <input type="hidden" name="detail_country" value="{{ request.GET.id|default:'' }}">

                <!-- Thông tin Detail Country -->
                {% if selected_detail %}
                    <div class="mb-3">
                        <p><strong>Detail Country:</strong> {{ selected_detail.name }}</p>
                        <p><strong>Child Category:</strong> {{ selected_detail.childcategory.title }}</p>
                    </div>
                {% else %}
                    <div class="mb-3 text-danger">
                        Vui lòng chọn Detail Country từ sidebar trước khi thêm blog.
                    </div>
                {% endif %}

                <!-- Title -->
                <div class="mb-3">
                    <label for="title" class="form-label">Title</label>
                    <input type="text" name="title" id="title" class="form-control" required>
                </div>

                <!-- Short Description -->
                <div class="mb-3">
                    <label for="short_description" class="form-label">Short Description</label>
                    <textarea name="short_description" id="short_description" class="form-control" rows="3" maxlength="1000"></textarea>
                </div>

                <!-- Blog Body (CKEditor) -->
                <div class="mb-3">
                    <label for="id_blog_body" class="form-label">Blog Body</label>
                    <textarea name="blog_body" id="id_blog_body" class="form-control" rows="10"></textarea>
                </div>

                <!-- Thumbnail -->
                <div class="mb-3">
                    <label for="blog_image" class="form-label">Thumbnail</label>
                    <input type="file" name="blog_image" id="blog_image" class="form-control">
                </div>

                <!-- Featured -->
                <div class="form-check mb-3">
                    <input type="checkbox" name="is_featured" id="featured" class="form-check-input">
                    <label for="featured" class="form-check-label">Featured</label>
                </div>

                <!-- Status -->
                <div class="mb-3">
                    <label for="status" class="form-label">Status</label>
                    <select name="status" id="status" class="form-select">
                        <option value="draft">Draft</option>
                        <option value="published">Published</option>
                    </select>
                </div>

                <!-- Buttons -->
                <button type="submit" class="btn btn-primary" {% if not selected_detail %}disabled{% endif %}>Save Blog</button>
                <a href="{% url 'blogs' %}" class="btn btn-secondary">Cancel</a>
            </form>
        </div>
    </div>
</div>

<!-- CKEditor -->
<script src="https://cdn.ckeditor.com/ckeditor5/39.0.0/classic/ckeditor.js"></script>
<script>
ClassicEditor
.create(document.querySelector('#id_blog_body'), {
    ckfinder: {
        uploadUrl: "{% url 'upload_image' %}"
    }
})
.then(editor => {
    const form = document.querySelector('form');
    form.addEventListener('submit', function() {
        document.querySelector('#id_blog_body').value = editor.getData();
    });
})
.catch(error => console.error(error));
</script>
