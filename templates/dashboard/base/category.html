<div class="col-md-9">
  <div class="card shadow-sm rounded">
    <div class="card-header bg-dark text-light d-flex justify-content-between align-items-center">
      <h4 class="mb-0">All Categories</h4>
      <!-- Nút mở modal Add -->
      <button class="btn btn-sm btn-light text-dark" data-bs-toggle="modal" data-bs-target="#addCategoryModal">
        + Add New Category
      </button>
    </div>
    <div class="card-body p-0">
      <table class="table table-hover table-striped table-bordered mb-0">
        <thead class="table-dark">
          <tr>
            <th style="width:5%">#</th>
            <th style="width:10%">Icon</th>
            <th style="width:25%">Category Name</th>
            <th style="width:20%">Created</th>
            <th style="width:20%">Updated</th>
            <th style="width:20%">Action</th>
          </tr>
        </thead>
        <tbody>
          {% for cat in categories %}
          <tr>
            <td>{{ forloop.counter }}</td>
            <td>
              {% if cat.icon %}
                <img src="{{ cat.icon.url }}" alt="icon" style="height:30px;">
              {% else %}
                <span class="text-muted">No icon</span>
              {% endif %}
            </td>
            <td>{{ cat.category_name }}</td>
            <td>{{ cat.created_at|date:"Y-m-d" }}</td>
            <td>{{ cat.updated_at|date:"Y-m-d" }}</td>
            <td>
              <!-- Nút Edit -->
              <button 
                class="btn btn-sm btn-outline-success"
                data-bs-toggle="modal"
                data-bs-target="#editCategoryModal"
                data-id="{{ cat.id }}"
                data-name="{{ cat.category_name }}">
                <i class="fa fa-edit"></i>
              </button>

              <!-- Nút Delete -->
              <form method="post" class="d-inline">
                {% csrf_token %}
                <input type="hidden" name="action" value="delete">
                <input type="hidden" name="cat_id" value="{{ cat.id }}">
                <button type="submit" class="btn btn-sm btn-outline-danger" onclick="return confirm('Delete this category?');">
                  <i class="fa fa-trash"></i>
                </button>
              </form>
            </td>
          </tr>
          {% empty %}
          <tr>
            <td colspan="6" class="text-center text-muted">No categories found.</td>
          </tr>
          {% endfor %}
        </tbody>
      </table>
    </div>
  </div>
</div>


<!-- Modal Add Category -->
<div class="modal fade" id="addCategoryModal" tabindex="-1" aria-labelledby="addCategoryModalLabel" aria-hidden="true">
  <div class="modal-dialog">
    <div class="modal-content">
      <form method="post" enctype="multipart/form-data">
        {% csrf_token %}
        <input type="hidden" name="action" value="add">
        <div class="modal-header bg-dark text-light">
          <h5 class="modal-title" id="addCategoryModalLabel">Add New Category</h5>
          <button type="button" class="btn-close btn-close-white" data-bs-dismiss="modal"></button>
        </div>
        <div class="modal-body bg-light">
          <div class="mb-3">
            <label class="form-label">Category Name</label>
            <input type="text" name="name" class="form-control" required>
          </div>
          <div class="mb-3">
            <label class="form-label">Icon</label>
            <input type="file" name="icon" class="form-control">
          </div>
        </div>
        <div class="modal-footer bg-dark">
          <button type="button" class="btn btn-secondary" data-bs-dismiss="modal">Cancel</button>
          <button type="submit" class="btn btn-primary">Save Category</button>
        </div>
      </form>
    </div>
  </div>
</div>


<!-- Modal Edit Category -->
<div class="modal fade" id="editCategoryModal" tabindex="-1" aria-labelledby="editCategoryModalLabel" aria-hidden="true">
  <div class="modal-dialog">
    <div class="modal-content">
      <form method="post" enctype="multipart/form-data">
        {% csrf_token %}
        <input type="hidden" name="action" value="edit">
        <input type="hidden" name="cat_id" id="editCatId">
        <div class="modal-header bg-dark text-light">
          <h5 class="modal-title" id="editCategoryModalLabel">Edit Category</h5>
          <button type="button" class="btn-close btn-close-white" data-bs-dismiss="modal"></button>
        </div>
        <div class="modal-body bg-light">
          <div class="mb-3">
            <label class="form-label">Category Name</label>
            <input type="text" name="name" id="editCatName" class="form-control" required>
          </div>
          <div class="mb-3">
            <label class="form-label">Icon</label>
            <input type="file" name="icon" class="form-control" >
            {% if cat.icon %}
              <p class="mt-2">Current: <img src="{{ cat.icon.url }}" alt="icon" style="height:30px;"></p>
            {% endif %}
          </div>
        </div>
        <div class="modal-footer bg-dark">
          <button type="button" class="btn btn-secondary" data-bs-dismiss="modal">Cancel</button>
          <button type="submit" class="btn btn-success">Update Category</button>
        </div>
      </form>
    </div>
  </div>
</div>


<script>
document.addEventListener("DOMContentLoaded", function () {
  var editModal = document.getElementById("editCategoryModal");
  editModal.addEventListener("show.bs.modal", function (event) {
    var button = event.relatedTarget;
    var catId = button.getAttribute("data-id");
    var catName = button.getAttribute("data-name");

    document.getElementById("editCatId").value = catId;
    document.getElementById("editCatName").value = catName;
  });
});
</script>
